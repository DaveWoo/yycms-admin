/*! table for Layui,Author:www.yyinfos.com 2018-09-30 */

layui.define(["laytpl","laypage","layer","form","util"],function(e){"use strict";var T=layui.$,v=layui.laytpl,r=layui.laypage,C=layui.layer,A=layui.form,h=(layui.util,layui.hint()),y=layui.device(),L={config:{checkName:"LAY_CHECKED",indexName:"LAY_TABLE_INDEX"},cache:{},index:layui.table?layui.table.index+1e4:0,set:function(e){var t=this;return t.config=T.extend({},t.config,e),t},on:function(e,t){return layui.onevent.call(this,f,e,t)}},s=function(){var t=this,e=t.config,i=e.id||e.index;return i&&(s.config[i]=e),{reload:function(e){t.reload.call(t,e)},setColsWidth:function(){t.setColsWidth.call(t)},config:e}},f="table",g="layui-hide",d="layui-none",o="layui-table-view",c=".layui-table-header",p=".layui-table-body",m=".layui-table-sort",b="layui-table-edit",x="layui-table-hover",t=function(e){return['<table cellspacing="0" cellpadding="0" border="0" class="layui-table" ','{{# if(d.data.skin){ }}lay-skin="{{d.data.skin}}"{{# } }} {{# if(d.data.size){ }}lay-size="{{d.data.size}}"{{# } }} {{# if(d.data.even){ }}lay-even{{# } }}>',"<thead>","{{# layui.each(d.data.cols, function(i1, item1){ }}","<tr>","{{# layui.each(item1, function(i2, item2){ }}",'{{# if(item2.fixed && item2.fixed !== "right"){ left = true; } }}','{{# if(item2.fixed === "right"){ right = true; } }}',(e=e||{}).fixed&&"right"!==e.fixed?'{{# if(item2.fixed && item2.fixed !== "right"){ }}':"right"===e.fixed?'{{# if(item2.fixed === "right"){ }}':"","{{# var isSort = !(item2.colGroup) && item2.sort; }}",'<th data-field="{{ item2.field||i2 }}" data-key="{{d.index}}-{{i1}}-{{i2}}" {{# if( item2.parentKey){ }}data-parentkey="{{ item2.parentKey }}"{{# } }} {{# if(item2.minWidth){ }}data-minwidth="{{item2.minWidth}}"{{# } }} {{#if(item2.colspan){}} colspan="{{item2.colspan}}"{{#} if(item2.rowspan){}} rowspan="{{item2.rowspan}}"{{#}}} {{# if(item2.unresize || item2.colGroup){ }}data-unresize="true"{{# } }} class="{{# if(item2.hide){ }}layui-hide{{# } }}{{# if(isSort){ }} layui-unselect{{# } }}{{# if(!item2.field){ }} layui-table-col-special{{# } }}">','<div class="layui-table-cell laytable-cell-',"{{# if(item2.colGroup){ }}","group","{{# } else { }}","{{d.index}}-{{i1}}-{{i2}}",'{{# if(item2.type !== "normal"){ }}'," laytable-cell-{{ item2.type }}","{{# } }}","{{# } }}",'" {{#if(item2.align){}}align="{{item2.align}}"{{#}}}>','{{# if(item2.type === "checkbox"){ }}','<input type="checkbox" name="layTableCheckbox" lay-skin="primary" lay-filter="layTableAllChoose" {{# if(item2[d.data.checkName]){ }}checked{{# }; }}>',"{{# } else { }}",'<span>{{item2.title||""}}</span>',"{{# if(isSort){ }}",'<span class="layui-table-sort layui-inline"><i class="layui-edge layui-table-sort-asc" title="升序"></i><i class="layui-edge layui-table-sort-desc" title="降序"></i></span>',"{{# } }}","{{# } }}","</div>","</th>",e.fixed?"{{# }; }}":"","{{# }); }}","</tr>","{{# }); }}","</thead>","</table>"].join("")},i=['<table cellspacing="0" cellpadding="0" border="0" class="layui-table" ','{{# if(d.data.skin){ }}lay-skin="{{d.data.skin}}"{{# } }} {{# if(d.data.size){ }}lay-size="{{d.data.size}}"{{# } }} {{# if(d.data.even){ }}lay-even{{# } }}>',"<tbody></tbody>","</table>"].join(""),u=['<div class="layui-form layui-border-box {{d.VIEW_CLASS}}" lay-filter="LAY-table-{{d.index}}" style="{{# if(d.data.width){ }}width:{{d.data.width}}px;{{# } }} {{# if(d.data.height){ }}height:{{d.data.height}}px;{{# } }}">',"{{# if(d.data.toolbar){ }}",'<div class="layui-table-tool">','<div class="layui-table-tool-temp"></div>','<div class="layui-table-tool-self"></div>',"</div>","{{# } }}",'<div class="layui-table-box">',"{{# if(d.loading){ }}",'<div class="layui-table-init" style="background-color: #fff;">','<i class="layui-icon layui-icon-loading layui-icon"></i>',"</div>","{{# } }}","{{# var left, right; }}",'<div class="layui-table-header">',t(),"</div>",'<div class="layui-table-body layui-table-main">',i,"</div>","{{# if(left){ }}",'<div class="layui-table-fixed layui-table-fixed-l">','<div class="layui-table-header">',t({fixed:!0}),"</div>",'<div class="layui-table-body">',i,"</div>","</div>","{{# }; }}","{{# if(right){ }}",'<div class="layui-table-fixed layui-table-fixed-r">','<div class="layui-table-header">',t({fixed:"right"}),'<div class="layui-table-mend"></div>',"</div>",'<div class="layui-table-body">',i,"</div>","</div>","{{# }; }}","</div>","{{# if(d.data.totalRow){ }}",'<div class="layui-table-total">','<table cellspacing="0" cellpadding="0" border="0" class="layui-table" ','{{# if(d.data.skin){ }}lay-skin="{{d.data.skin}}"{{# } }} {{# if(d.data.size){ }}lay-size="{{d.data.size}}"{{# } }} {{# if(d.data.even){ }}lay-even{{# } }}>','<tbody><tr><td><div class="layui-table-cell" style="visibility: hidden;">Total</div></td></tr></tbody>',"</table>","</div>","{{# } }}","{{# if(d.data.page){ }}",'<div class="layui-table-page">','<div id="layui-table-page{{d.index}}"></div>',"</div>","{{# } }}","<style>","{{# layui.each(d.data.cols, function(i1, item1){","layui.each(item1, function(i2, item2){ }}",".laytable-cell-{{d.index}}-{{i1}}-{{i2}}{ ","{{# if(item2.width){ }}","width: {{item2.width}}px;","{{# } }}"," }","{{# });","}); }}","</style>","</div>"].join(""),k=T(window),w=T(document),a=function(e){var t=this;t.index=++L.index,t.config=T.extend({},t.config,L.config,e),t.render()};a.prototype.config={limit:10,loading:!0,cellMinWidth:60,defaultToolbar:["filter","exports","print"],text:{none:"无数据"}},a.prototype.render=function(){var e=this,t=e.config;if(t.elem=T(t.elem),t.where=t.where||{},t.id=t.id||t.elem.attr("id")||t.index,t.request=T.extend({pageName:"page",limitName:"limit"},t.request),t.response=T.extend({statusName:"code",statusCode:0,msgName:"msg",dataName:"data",countName:"count"},t.response),"object"==typeof t.page&&(t.limit=t.page.limit||t.limit,t.limits=t.page.limits||t.limits,e.page=t.page.curr=t.page.curr||1,delete t.page.elem,delete t.page.jump),!t.elem[0])return e;t.height&&/^full-\d+$/.test(t.height)&&(e.fullHeightGap=t.height.split("-")[1],t.height=k.height()-e.fullHeightGap),e.setInit();var i=t.elem,a=i.next("."+o),l=e.elem=T(v(u).render({VIEW_CLASS:o,data:t,index:e.index}));if(t.index=e.index,a[0]&&a.remove(),i.after(l),e.layTool=l.find(".layui-table-tool"),e.layBox=l.find(".layui-table-box"),e.layHeader=l.find(c),e.layMain=l.find(".layui-table-main"),e.layBody=l.find(p),e.layFixed=l.find(".layui-table-fixed"),e.layFixLeft=l.find(".layui-table-fixed-l"),e.layFixRight=l.find(".layui-table-fixed-r"),e.layTotal=l.find(".layui-table-total"),e.layPage=l.find(".layui-table-page"),e.renderToolbar(),e.fullSize(),1<t.cols.length){var n=e.layFixed.find(c).find("th");n.height(e.layHeader.height()-1-parseFloat(n.css("padding-top"))-parseFloat(n.css("padding-bottom")))}e.pullData(e.page),e.events()},a.prototype.initOpts=function(e){this.config;e.checkbox&&(e.type="checkbox"),e.space&&(e.type="space"),e.type||(e.type="normal"),"normal"!==e.type&&(e.unresize=!0,e.width=e.width||{checkbox:48,radio:48,space:15,numbers:40}[e.type])},a.prototype.setInit=function(e){var a,t=this,o=t.config;if(o.clientWidth=o.width||(a=function(e){var t,i;t=(e=e||o.elem.parent()).width();try{i="none"===e.css("display")}catch(e){}return!e[0]||t&&!i?t:a(e.parent())})(),"width"===e)return o.clientWidth;layui.each(o.cols,function(n,e){layui.each(e,function(i,a){if(a){if(a.key=n+"-"+i,a.hide=a.hide||!1,a.colGroup||1<a.colspan){var l=0;layui.each(o.cols[n+1],function(e,t){t.HAS_PARENT||1<l&&l==a.colspan||(t.HAS_PARENT=!0,t.parentKey=n+"-"+i,l+=parseInt(1<t.colspan?t.colspan:1))}),a.colGroup=!0}t.initOpts(a)}else e.splice(i,1)})})},a.prototype.goTourl=function(e){0<layui.router().path.length?(e=e.split(".")[0],location.hash=e):location.href=e},a.prototype.reqAjax=function(e){var t=this,i=t.config,a=(i.request,i.response),l={data:{access_token:i.token||""}};T.extend(!0,l,e),T.ajax({type:l.type||"post",url:l.url,data:l.data,dataType:"json",success:function(e){"function"==typeof l.done?l.done(e):("function"==typeof i.parseData&&(e=i.parseData(e)||e),1==e[a.statusName]?C.msg(e[a.msgName],{icon:1,time:1e3},function(){t.config.data&&t.config.data.constructor===Array&&delete t.config.data,t.config.where={},t.render()}):C.msg(e[a.msgName],{icon:2,time:1e3},function(){e.url&&t.goTourl(e.url)}))},error:function(e,t){C.msg("数据接口请求异常："+t,{icon:2,time:2e3})}})},a.prototype.YYToolBtn=function(e){var l=['<div class="layui-inline"><input class="layui-input" value="" style="width:150px;height:31px;" name="LAYTABLE_SEARCHKEY" placeholder="请输入关键字"></div>','<button class="layui-btn layui-btn-sm" lay-event="LAYTABLE_SEARCH" lay-options="{}"><i class="layui-icon layui-icon-search"></i>搜索</button>','<button class="layui-btn layui-btn-sm" lay-event="LAYTABLE_REFRESH" lay-options="{}"><i class="layui-icon layui-icon-refresh"></i>刷新</button>'].join(""),n=[];return layui.each(e,function(e,t){var i={height:380,width:580,formType:2,icon:"",url:"",class:"",title:"",field:""};if(T.extend(!0,i,t),i.type)switch(i.type){case"search":n.push(l);break;case"delall":var a=i.title?i.title:"批量删除";n.push('<button class="layui-btn layui-btn-sm layui-btn-danger"  lay-options='+JSON.stringify(i)+' lay-event="LAYTABLE_DELALL"><i class="layui-icon '+i.icon+'"></i>'+a+"</button>");break;case"del":a=i.title?i.title:"删除";n.push('<button class="layui-btn layui-btn-sm layui-btn-danger"  lay-options='+JSON.stringify(i)+' lay-event="LAYTABLE_DEL"><i class="layui-icon '+i.icon+'"></i>'+a+"</button>");break;case"dialog":n.push('<button class="layui-btn layui-btn-sm '+i.class+'" lay-options='+JSON.stringify(i)+' lay-event="LAYTABLE_DIALOG"><i class="layui-icon '+i.icon+'"></i>'+i.title+"</button>");break;case"prompt":n.push('<button class="layui-btn layui-btn-sm '+i.class+'" lay-options='+JSON.stringify(i)+'  lay-event="LAYTABLE_PROMPT"><i class="layui-icon '+i.icon+'"></i>'+i.title+"</button>");break;case"link":n.push('<button class="layui-btn layui-btn-sm '+i.class+'" lay-options='+JSON.stringify(i)+' lay-event="LAYTABLE_LINK"><i class="layui-icon '+i.icon+'"></i>'+i.title+"</button>");break;case"ajax":n.push('<button class="layui-btn layui-btn-sm '+i.class+'" lay-options='+JSON.stringify(i)+' lay-event="LAYTABLE_AJAX"><i class="layui-icon '+i.icon+'"></i>'+i.title+"</button>")}else n.push('<button class="layui-btn layui-btn-sm '+i.class+'" lay-options='+JSON.stringify(i)+' lay-event="'+i.event+'"><i class="layui-icon '+i.icon+'"></i>'+i.title+"</button>")}),n},a.prototype.YYTool=function(e){var t=this.layTool.find(".layui-table-tool-temp");if("object"==typeof e.toolbar)t.html(this.YYToolBtn(e.toolbar));else{var i=T(e.toolbar).html()||"";i&&t.html(v(i).render(e))}},a.prototype.renderToolbar=function(){var e=this.config,t=['<div class="layui-inline" lay-event="add"><i class="layui-icon layui-icon-add-1"></i></div>','<div class="layui-inline" lay-event="update"><i class="layui-icon layui-icon-edit"></i></div>','<div class="layui-inline" lay-event="delete"><i class="layui-icon layui-icon-delete"></i></div>'].join(""),i=this.layTool.find(".layui-table-tool-temp");"default"===e.toolbar?i.html(t):e.toolbar&&this.YYTool(e);var a={filter:{title:"筛选列",layEvent:"LAYTABLE_COLS",icon:"layui-icon-cols"},exports:{title:"导出",layEvent:"LAYTABLE_EXPORT",icon:"layui-icon-export"},print:{title:"打印",layEvent:"LAYTABLE_PRINT",icon:"layui-icon-print"}},l=[];"object"==typeof e.defaultToolbar&&layui.each(e.defaultToolbar,function(e,t){var i=a[t];i&&l.push('<div class="layui-inline"  title="'+i.title+'" lay-event="'+i.layEvent+'"><i class="layui-icon '+i.icon+'"></i></div>')}),this.layTool.find(".layui-table-tool-self").html(l.join(""))},a.prototype.setParentCol=function(e,t){var i=this.config,a=this.layHeader.find('th[data-key="'+i.index+"-"+t+'"]'),l=parseInt(a.attr("colspan"))||0;if(a[0]){var n=t.split("-"),o=i.cols[n[0]][n[1]];e?l--:l++,a.attr("colspan",l),a[l<1?"addClass":"removeClass"](g),o.colspan=l,o.hide=l<1;var c=a.data("parentkey");c&&this.setParentCol(e,c)}},a.prototype.setColsPatch=function(){var i=this,e=i.config;layui.each(e.cols,function(e,t){layui.each(t,function(e,t){t.hide&&i.setParentCol(t.hide,t.parentKey)})})},a.prototype.setColsWidth=function(){var a=this,o=a.config,i=0,c=0,s=0,r=0,d=a.setInit("width");a.eachCols(function(e,t){t.hide||i++}),d=d-("line"===o.skin||"nob"===o.skin?2:i+1)-a.getScrollWidth(a.layMain[0])-1;var e=function(n){layui.each(o.cols,function(e,l){layui.each(l,function(e,t){var i=0,a=t.minWidth||o.cellMinWidth;t?t.colGroup||t.hide||(n?s&&s<a&&(c--,i=a):(i=t.width||0,/\d+%$/.test(i)?(i=Math.floor(parseFloat(i)/100*d))<a&&(i=a):i||(t.width=i=0,c++)),t.hide&&(i=0),r+=i):l.splice(e,1)})}),r<d&&c&&(s=(d-r)/c)};e(),e(!0),a.autoColNums=c,a.eachCols(function(e,t){var i=t.minWidth||o.cellMinWidth;t.colGroup||t.hide||(0===t.width?a.getCssRule(o.index+"-"+t.key,function(e){e.style.width=Math.floor(i<=s?s:i)+"px"}):/\d+%$/.test(t.width)&&a.getCssRule(o.index+"-"+t.key,function(e){e.style.width=Math.floor(parseFloat(t.width)/100*d)+"px"}))});var l=a.layMain.width()-a.getScrollWidth(a.layMain[0])-a.layMain.children("table").outerWidth();if(a.autoColNums&&-i<=l&&l<=i){var t=function(e){return!(e=e||a.layHeader.eq(0).find("thead th:last-child")).data("field")&&e.prev()[0]?t(e.prev()):e},n=t(),u=n.data("key");a.getCssRule(u,function(e){var t=e.style.width||n.outerWidth();e.style.width=parseFloat(t)+l+"px",0<a.layMain.height()-a.layMain.prop("clientHeight")&&(e.style.width=parseFloat(e.style.width)-1+"px")})}a.loading(!0)},a.prototype.reload=function(e){var t=this;t.config.data&&t.config.data.constructor===Array&&delete t.config.data,t.config=T.extend({},t.config,e),t.render()},a.prototype.page=1,a.prototype.pullData=function(t){var i=this,a=i.config,e=a.request,l=a.response,n=function(){"object"==typeof a.initSort&&i.sort(a.initSort.field,a.initSort.type)};if(i.startTime=(new Date).getTime(),a.url){var o={};o[e.pageName]=t,o[e.limitName]=a.limit;var c=T.extend(o,a.where);a.contentType&&0==a.contentType.indexOf("application/json")&&(c=JSON.stringify(c)),T.ajax({type:a.method||"get",url:a.url,contentType:a.contentType,data:c,dataType:"json",headers:a.headers||{},success:function(e){"function"==typeof a.parseData&&(e=a.parseData(e)||e),e[l.statusName]!=l.statusCode?(i.renderForm(),i.layMain.html('<div class="'+d+'">'+(e[l.msgName]||"返回的数据不符合规范，正确的成功状态码 ("+l.statusName+") 应为："+l.statusCode)+"</div>")):(i.renderData(e,t,e[l.countName]),n(),a.time=(new Date).getTime()-i.startTime+" ms"),i.setColsWidth(),"function"==typeof a.done&&a.done(e,t,e[l.countName])},error:function(e,t){i.layMain.html('<div class="'+d+'">数据接口请求异常：'+t+"</div>"),i.renderForm(),i.setColsWidth()}})}else if(a.data&&a.data.constructor===Array){var s={},r=t*a.limit-a.limit;s[l.dataName]=a.data.concat().splice(r,a.limit),s[l.countName]=a.data.length,i.renderData(s,t,a.data.length),n(),i.setColsWidth(),"function"==typeof a.done&&a.done(s,t,s[l.countName])}},a.prototype.eachCols=function(e){return L.eachCols(null,e,this.config.cols),this},a.prototype.renderData=function(e,t,i,a){var p=this,m=p.config,l=e[m.response.dataName]||[],n=[],o=[],c=[],s=function(){var f;if(!a&&p.sortKey)return p.sort(p.sortKey.field,p.sortKey.sort,!0);layui.each(l,function(s,r){var d=[],u=[],y=[],h=s+m.limit*(t-1)+1;0!==r.length&&(a||(r[L.config.indexName]=s),p.eachCols(function(e,a){var t=a.field||e,i=m.index+"-"+a.key,l=r[t];if(null==l&&(l=""),!a.colGroup){var n,o,c=['<td data-field="'+t+'" data-key="'+i+'" '+(o=[],a.edit&&o.push('data-edit="'+a.edit+'"'),a.align&&o.push('align="'+a.align+'"'),a.templet&&o.push('data-content="'+l+'"'),a.toolbar&&o.push('data-off="true"'),a.event&&o.push('lay-event="'+a.event+'"'),a.style&&o.push('style="'+a.style+'"'),a.minWidth&&o.push('data-minwidth="'+a.minWidth+'"'),o.join(" "))+' class="'+(n=[],a.hide&&n.push(g),a.field||n.push("layui-table-col-special"),n.join(" "))+'">','<div class="layui-table-cell laytable-cell-'+("normal"===a.type?i:i+" laytable-cell-"+a.type)+'">'+function(){var e=T.extend(!0,{LAY_INDEX:h},r),t=L.config.checkName;switch(a.type){case"checkbox":return'<input type="checkbox" name="layTableCheckbox" lay-skin="primary" '+(a[t]?(r[t]=a[t],a[t]?"checked":""):e[t]?"checked":"")+">";case"radio":return e[t]&&(f=s),'<input type="radio" name="layTableRadio_'+m.index+'" '+(e[t]?"checked":"")+' lay-type="layTableRadio">';case"numbers":return h}if(a.switchTpl){var i=1==l?"checked":"";return'<input type="checkbox" name="'+a.field+'" lay-skin="switch" lay-text="'+a.switchTpl+'" lay-event="switch"'+i+">"}if(a.checkboxTpl){i=1==l?"checked":"";return'<input type="checkbox" name="'+a.field+'" title="'+a.checkboxTpl+'" lay-event="switch"'+i+">"}return a.toolbar?"object"==typeof a.toolbar?p.YYToolBtn(a.toolbar).join(""):v(T(a.toolbar).html()||"").render(e):a.templet?"function"==typeof a.templet?a.templet(e):v(T(a.templet).html()||String(l)).render(e):l}(),"</div></td>"].join("");d.push(c),a.fixed&&"right"!==a.fixed&&u.push(c),"right"===a.fixed&&y.push(c)}}),n.push('<tr data-index="'+s+'">'+d.join("")+"</tr>"),o.push('<tr data-index="'+s+'">'+u.join("")+"</tr>"),c.push('<tr data-index="'+s+'">'+y.join("")+"</tr>"))}),p.layBody.scrollTop(0),p.layMain.find("."+d).remove(),p.layMain.find("tbody").html(n.join("")),p.layFixLeft.find("tbody").html(o.join("")),p.layFixRight.find("tbody").html(c.join("")),p.renderForm(),"number"==typeof f&&p.setThisRowChecked(f),p.syncCheckAll(),p.scrollPatch(),C.close(p.tipsIndex),m.HAS_SET_COLS_PATCH||p.setColsPatch(),m.HAS_SET_COLS_PATCH=!0};return p.key=m.id||m.index,L.cache[p.key]=l,p.layPage[0==i||0===l.length&&1==t?"addClass":"removeClass"](g),a?s():0===l.length?(p.renderForm(),p.layFixed.remove(),p.layMain.find("tbody").html(""),p.layMain.find("."+d).remove(),p.layMain.append('<div class="'+d+'">'+m.text.none+"</div>")):(s(),p.renderTotal(l),void(m.page&&(m.page=T.extend({elem:"layui-table-page"+m.index,count:i,limit:m.limit,limits:m.limits||[10,20,30,40,50,60,70,80,90],groups:3,layout:["prev","page","next","skip","count","limit"],prev:'<i class="layui-icon">&#xe603;</i>',next:'<i class="layui-icon">&#xe602;</i>',jump:function(e,t){t||(p.page=e.curr,m.limit=e.limit,p.loading(),p.pullData(e.curr))}},m.page),m.page.count=i,r.render(m.page))))},a.prototype.renderTotal=function(e){var t=this,c=t.config,s={};if(c.totalRow){layui.each(e,function(e,l){0!==l.length&&t.eachCols(function(e,t){var i=t.field||e,a=l[i];t.totalRow&&(s[i]=(s[i]||0)+(parseFloat(a)||0))})});var r=[];t.eachCols(function(e,t){var i=t.field||e;if(!t.hide){var a,l,n,o=['<td data-field="'+i+'" data-key="'+t.key+'" '+(n=[],t.align&&n.push('align="'+t.align+'"'),t.style&&n.push('style="'+t.style+'"'),t.minWidth&&n.push('data-minwidth="'+t.minWidth+'"'),n.join(" "))+">",'<div class="layui-table-cell laytable-cell-'+(l=c.index+"-"+t.key,"normal"===t.type?l:l+" laytable-cell-"+t.type)+'">'+(a=t.totalRowText||"",t.totalRow&&s[i]||a),"</div></td>"].join("");r.push(o)}}),t.layTotal.find("tbody").html("<tr>"+r.join("")+"</tr>")}},a.prototype.getColElem=function(e,t){var i=this.config;return e.eq(0).find(".laytable-cell-"+i.index+"-"+t+":eq(0)")},a.prototype.renderForm=function(e){A.render(e,"LAY-table-"+this.index)},a.prototype.setThisRowChecked=function(e){this.config;var t="layui-table-click";this.layBody.find('tr[data-index="'+e+'"]').addClass(t).siblings("tr").removeClass(t)},a.prototype.sort=function(l,e,t,i){var a,n=this,o={},c=n.config,s=c.elem.attr("lay-filter"),r=L.cache[n.key];"string"==typeof l&&n.layHeader.find("th").each(function(e,t){var i=T(this),a=i.data("field");if(a===l)return l=i,d=a,!1});try{var d=d||l.data("field"),u=l.data("key");if(n.sortKey&&!t&&d===n.sortKey.field&&e===n.sortKey.sort)return;var y=n.layHeader.find("th .laytable-cell-"+u).find(m);n.layHeader.find("th").find(m).removeAttr("lay-sort"),y.attr("lay-sort",e||null),n.layFixed.find("th")}catch(e){return h.error("Table modules: Did not match to field")}n.sortKey={field:d,sort:e},"asc"===e?a=layui.sort(r,d):"desc"===e?a=layui.sort(r,d,!0):(a=layui.sort(r,L.config.indexName),delete n.sortKey),o[c.response.dataName]=a,n.renderData(o,n.page,n.count,!0),i&&layui.event.call(l,f,"sort("+s+")",{field:d,type:e})},a.prototype.loading=function(e){var t=this;t.config.loading&&(e?(t.layInit&&t.layInit.remove(),delete t.layInit,t.layBox.find(".layui-table-init").remove()):(t.layInit=T(['<div class="layui-table-init">','<i class="layui-icon layui-icon-loading layui-icon"></i>',"</div>"].join("")),t.layBox.append(t.layInit)))},a.prototype.setCheckData=function(e,t){var i=this.config,a=L.cache[this.key];a[e]&&a[e].constructor!==Array&&(a[e][i.checkName]=t)},a.prototype.syncCheckAll=function(){var e=this,a=e.config,t=e.layHeader.find('input[name="layTableCheckbox"]'),i=function(i){return e.eachCols(function(e,t){"checkbox"===t.type&&(t[a.checkName]=i)}),i};t[0]&&(L.checkStatus(e.key).isAll?(t[0].checked||(t.prop("checked",!0),e.renderForm("checkbox")),i(!0)):(t[0].checked&&(t.prop("checked",!1),e.renderForm("checkbox")),i(!1)))},a.prototype.getCssRule=function(i,a){var e=this.elem.find("style")[0],t=e.sheet||e.styleSheet||{},l=t.cssRules||t.rules;layui.each(l,function(e,t){if(t.selectorText===".laytable-cell-"+i)return a(t),!0})},a.prototype.fullSize=function(){var e,t=this,i=t.config,a=i.height;t.fullHeightGap&&((a=k.height()-t.fullHeightGap)<135&&(a=135),t.elem.css("height",a)),a&&(e=parseFloat(a)-(t.layHeader.outerHeight()||38),i.toolbar&&(e-=t.layTool.outerHeight()||50),i.totalRow&&(e-=t.layTotal.outerHeight()||40),i.page&&(e=e-(t.layPage.outerHeight()||41)-2),t.layMain.css("height",e))},a.prototype.getScrollWidth=function(e){var t=0;return e?t=e.offsetWidth-e.clientWidth:((e=document.createElement("div")).style.width="100px",e.style.height="100px",e.style.overflowY="scroll",document.body.appendChild(e),t=e.offsetWidth-e.clientWidth,document.body.removeChild(e)),t},a.prototype.scrollPatch=function(){var e=this,t=e.layMain.children("table"),i=e.layMain.width()-e.layMain.prop("clientWidth"),a=e.layMain.height()-e.layMain.prop("clientHeight"),l=(e.getScrollWidth(e.layMain[0]),t.outerWidth()-e.layMain.width()),n=function(e){if(i&&a){if(!(e=e.eq(0)).find(".layui-table-patch")[0]){var t=T('<th class="layui-table-patch"><div class="layui-table-cell"></div></th>');t.find("div").css({width:i}),e.find("tr").append(t)}}else e.find(".layui-table-patch").remove()};n(e.layHeader),n(e.layTotal);var o=e.layMain.height()-a;e.layFixed.find(p).css("height",t.height()>o?o:"auto"),e.layFixRight[0<l?"removeClass":"addClass"](g),e.layFixRight.css("right",i-1)},a.prototype.YYevents=function(e,t,i){if(!T(e).attr("lay-options"))return!1;var a=this,l=T("body"),n=T.parseJSON(T(e).attr("lay-options"))||{},o=i.data?n.url+"?"+a.config.pk+"="+i.data[a.config.pk]:n.url||"",c=n.templet&&l.find(n.templet).html()||"",s=n.width||580,r=n.height||380,d=n.title||T(e).text(),u=n.poptype||1,y="popDialog"+Math.random().toString(36).substr(2),h={url:n.url,data:{}};switch(T.extend(!0,h,i),t){case"LAYTABLE_SEARCH":var f=a.layTool.find('*[name="LAYTABLE_SEARCHKEY"]').val();0==f.length?C.msg("请输入搜素关键字",{icon:2,time:1e3}):(a.config.data&&a.config.data.constructor===Array&&delete a.config.data,a.config=T.extend(!0,a.config.where,{key:f}),a.render());break;case"LAYTABLE_REFRESH":a.config.data&&a.config.data.constructor===Array&&delete a.config.data,a.config=T.extend(!0,a.config.where,{key:""}),a.render();break;case"LAYTABLE_AJAX":a.reqAjax(h);break;case"LAYTABLE_DEL":C.confirm("您确定要删除该记录吗？",function(e){a.reqAjax(h)});break;case"LAYTABLE_DELALL":var p=L.checkStatus(a.key).data,m=[];if(0==p.length)return C.msg("请选择要删除的信息",{icon:2,time:1e3}),!1;C.confirm("您确定要删除该记录吗？",function(e){T(p).each(function(e,t){m.push(t[a.config.pk])}),h.data.ids=m.join(","),a.reqAjax(h)});break;case"LAYTABLE_LINK":a.goTourl(o);break;case"LAYTABLE_DIALOG":var v=C.open({type:u,title:d,shadeClose:!0,area:[s+"px",r+"px"],content:1==u?'<div id="'+y+'" style="padding:10px;">'+c+"</div>":o});""==c&&1==u&&T.ajax({type:"get",url:o,data:i.data||{},dataType:"html",success:function(e){T("#"+y).html(e),A.render()},error:function(e,t){C.msg("数据接口请求异常："+t,{icon:2,time:2e3})}}),T("body").on("click","*[lay-close]",function(){C.close(v)}),A.on("submit(submit)",function(e){var t=T(this).data("href")||o;return h={url:t,type:"post",data:e.field},a.reqAjax(h),C.close(v),!1});break;case"LAYTABLE_PROMPT":var g=n.formType||2,b=n.field||"data",x=L.checkStatus(a.key).data,k=[];0<x.length&&(T(x).each(function(e,t){k.push(t[a.config.pk])}),h.data.ids=k.join(",")),C.prompt({title:d,formType:g},function(e,t){h.data[b]=e,a.reqAjax(h)})}},a.prototype.events=function(){var n,s=this,r=s.config,l=T("body"),o={},e=s.layHeader.find("th"),c=".layui-table-cell",d=r.elem.attr("lay-filter");s.layBody.on("click",".layui-form-switch",function(){var e=T(this),t=e.parents("tr").eq(0).data("index"),i=e.siblings("input").eq(0),a=u.call(this),l=i.attr("name"),n=e.hasClass("layui-form-onswitch")||e.hasClass("layui-form-checked")?1:0;s.config.editurl?(a.data[l]=n,s.reqAjax({url:s.config.editurl,data:a.data,done:function(e){"function"==typeof r.parseData&&(e=r.parseData(e)||e),1==e[r.response.statusName]?C.msg(e[r.response.msgName],{icon:1,time:1e3}):C.msg(e[r.response.msgName],{icon:2,time:1e3})}})):layui.event.call(this,f,"tool("+d+")",u.call(this,{event:i.attr("lay-event"),name:l,value:n})),s.setThisRowChecked(t)}),s.layBody.on("click","*[lay-event]",function(){var e=T(this),t=e.parents("tr").eq(0).data("index"),i=e.attr("lay-event");s.YYevents(this,i,u.call(this)),layui.event.call(this,f,"tool("+d+")",u.call(this,{event:i})),s.setThisRowChecked(t)}),s.layTool.on("click","*[lay-event]",function(e){var i,a=T(this),t=a.attr("lay-event"),l=function(e){var t=T(e.list),i=T('<ul class="layui-table-tool-panel"></ul>');i.html(t),a.find(".layui-table-tool-panel")[0]||a.append(i),s.renderForm(),i.on("click",function(e){layui.stope(e)}),e.done&&e.done(i,t)};switch(layui.stope(e),w.trigger("table.tool.panel.remove"),C.close(s.tipsIndex),s.YYevents(this,t,{}),t){case"LAYTABLE_COLS":l({list:(i=[],s.eachCols(function(e,t){t.field&&"normal"==t.type&&i.push('<li><input type="checkbox" name="'+t.field+'" data-key="'+t.key+'" data-parentkey="'+(t.parentKey||"")+'" lay-skin="primary" '+(t.hide?"":"checked")+' title="'+(t.title||t.field)+'" lay-filter="LAY_TABLE_TOOL_COLS"></li>')}),i.join("")),done:function(){A.on("checkbox(LAY_TABLE_TOOL_COLS)",function(e){var t=T(e.elem),l=this.checked,n=t.data("key"),o=t.data("parentkey");layui.each(r.cols,function(a,e){layui.each(e,function(e,t){if(a+"-"+e===n){var i=t.hide;t.hide=!l,s.elem.find('*[data-key="'+r.index+"-"+n+'"]')[l?"removeClass":"addClass"](g),i!=t.hide&&s.setParentCol(!l,o),s.fullSize(),s.scrollPatch(),s.setColsWidth()}})})})}});break;case"LAYTABLE_EXPORT":y.ie?C.tips("导出功能不支持 IE，请用 Chrome 等高级浏览器导出",this,{tips:3}):l({list:['<li data-type="csv">导出到 Csv 文件</li>','<li data-type="xls">导出到 Excel 文件</li>'].join(""),done:function(e,t){t.on("click",function(){var e=T(this).data("type");L.exportFile(r.id,null,e)})}});break;case"LAYTABLE_PRINT":var n=window.open("打印窗口","_blank"),o=["<style>","body{font-size: 12px; color: #666;}","table{width: 100%; border-collapse: collapse; border-spacing: 0;}","th,td{line-height: 20px; padding: 9px 15px; border: 1px solid #ccc; text-align: left; font-size: 12px; color: #666;}","a{color: #666; text-decoration:none;}","*.layui-hide{display: none}","</style>"].join(""),c=T(s.layHeader.html());c.append(s.layMain.find("table").html()),c.find("th.layui-table-patch").remove(),c.find(".layui-table-col-special").remove(),n.document.write(o+c.prop("outerHTML")),n.document.close(),n.print(),n.close()}layui.event.call(this,f,"toolbar("+d+")",T.extend({event:t,config:r},{}))}),e.on("mousemove",function(e){var t=T(this),i=t.offset().left,a=e.clientX-i;t.data("unresize")||o.resizeStart||(o.allowResize=t.width()-a<=10,l.css("cursor",o.allowResize?"col-resize":""))}).on("mouseleave",function(){T(this);o.resizeStart||l.css("cursor","")}).on("mousedown",function(e){var i=T(this);if(o.allowResize){var t=i.data("key");e.preventDefault(),o.resizeStart=!0,o.offset=[e.clientX,e.clientY],s.getCssRule(t,function(e){var t=e.style.width||i.outerWidth();o.rule=e,o.ruleWidth=parseFloat(t),o.minWidth=i.data("minwidth")||r.cellMinWidth})}}),w.on("mousemove",function(e){if(o.resizeStart){if(e.preventDefault(),o.rule){var t=o.ruleWidth+e.clientX-o.offset[0];t<o.minWidth&&(t=o.minWidth),o.rule.style.width=t+"px",C.close(s.tipsIndex)}n=1}}).on("mouseup",function(e){o.resizeStart&&(o={},l.css("cursor",""),s.scrollPatch()),2===n&&(n=null)}),e.on("click",function(e){var t,i=T(this),a=i.find(m),l=a.attr("lay-sort");if(!a[0]||1===n)return n=2;t="asc"===l?"desc":"desc"===l?null:"asc",s.sort(i,t,null,!0)}).find(m+" .layui-edge ").on("click",function(e){var t=T(this),i=t.index(),a=t.parents("th").eq(0).data("field");layui.stope(e),0===i?s.sort(a,"asc",null,!0):s.sort(a,"desc",null,!0)});var u=function(e){var t=T(this).parents("tr").eq(0).data("index"),l=s.layBody.find('tr[data-index="'+t+'"]'),n=L.cache[s.key][t];return T.extend({tr:l,data:L.clearCacheKey(n),del:function(){L.cache[s.key][t]=[],l.remove(),s.scrollPatch()},update:function(e){e=e||{},layui.each(e,function(i,e){if(i in n){var a,t=l.children('td[data-field="'+i+'"]');n[i]=e,s.eachCols(function(e,t){t.field==i&&t.templet&&(a=t.templet)}),t.children(c).html(a?"function"==typeof a?a(n):v(T(a).html()||e).render(n):e),t.data("content",e)}})}},e)};s.elem.on("click",'input[name="layTableCheckbox"]+',function(){var e=T(this).prev(),t=s.layBody.find('input[name="layTableCheckbox"]'),i=e.parents("tr").eq(0).data("index"),a=e[0].checked,l="layTableAllChoose"===e.attr("lay-filter");l?(t.each(function(e,t){t.checked=a,s.setCheckData(e,a)}),s.syncCheckAll(),s.renderForm("checkbox")):(s.setCheckData(i,a),s.syncCheckAll()),layui.event.call(this,f,"checkbox("+d+")",u.call(this,{checked:a,type:l?"all":"one"}))}),s.elem.on("click",'input[lay-type="layTableRadio"]+',function(){var e=T(this).prev(),t=e[0].checked,i=L.cache[s.key],a=e.parents("tr").eq(0).data("index");layui.each(i,function(e,t){a===e?t.LAY_CHECKED=!0:delete t.LAY_CHECKED}),s.setThisRowChecked(a),layui.event.call(this,f,"radio("+d+")",u.call(this,{checked:t}))}),s.layBody.on("mouseenter","tr",function(){var e=T(this).index();s.layBody.find("tr:eq("+e+")").addClass(x)}).on("mouseleave","tr",function(){var e=T(this).index();s.layBody.find("tr:eq("+e+")").removeClass(x)}).on("click","tr",function(){t.call(this,"row")}).on("dblclick","tr",function(){t.call(this,"rowDouble")});var t=function(e){var t=T(this);layui.event.call(this,f,e+"("+d+")",u.call(t.children("td")[0]))};s.layBody.on("change","."+b,function(){var e=T(this),t=this.value,i=e.parent().data("field"),a=e.parents("tr").eq(0).data("index"),l=L.cache[s.key][a],n=s.config;l[i]=t,s.config.editurl?s.reqAjax({url:s.config.editurl,data:l,done:function(e){"function"==typeof n.parseData&&(e=n.parseData(e)||e),1==e[n.response.statusName]?C.msg(e[n.response.msgName],{icon:1,time:1e3}):C.msg(e[n.response.msgName],{icon:2,time:1e3})}}):layui.event.call(this,f,"edit("+d+")",u.call(this,{value:t,field:i}))}).on("blur","."+b,function(){var i,e,t=T(this),a=t.parent().data("field"),l=t.parents("tr").eq(0).data("index"),n=L.cache[s.key][l];s.eachCols(function(e,t){t.field==a&&t.templet&&(i=t.templet)}),t.siblings(c).html((e=this.value,i?function(){return"function"==typeof i?i(n):v(T(i).html()||this.value).render(n)}():e)),t.parent().data("content",this.value),t.remove()}),s.layBody.on("click","td",function(){var e=T(this),t=(e.data("field"),e.data("edit")),i=e.children(c);if(!e.data("off")&&t){var a=T('<input class="layui-input '+b+'">');return a[0].value=e.data("content")||i.text(),e.find("."+b)[0]||e.append(a),void a.focus()}}).on("mouseenter","td",function(){i.call(this)}).on("mouseleave","td",function(){i.call(this,"hide")});var a="layui-table-grid-down",i=function(e){var t=T(this),i=t.children(c);if(e)t.find(".layui-table-grid-down").remove();else if(i.prop("scrollWidth")>i.outerWidth()){if(i.find("."+a)[0])return;t.append('<div class="'+a+'"><i class="layui-icon layui-icon-down"></i></div>')}};s.layBody.on("click","."+a,function(){var e=T(this).parent().children(c);s.tipsIndex=C.tips(['<div class="layui-table-tips-main" style="margin-top: -'+(e.height()+16)+"px;"+("sm"===r.size?"padding: 4px 15px; font-size: 12px;":"lg"===r.size?"padding: 14px 15px;":"")+'">',e.html(),"</div>",'<i class="layui-icon layui-table-tips-c layui-icon-close"></i>'].join(""),e[0],{tips:[3,""],time:-1,anim:-1,maxWidth:y.ios||y.android?300:s.elem.width()/2,isOutAnim:!1,skin:"layui-table-tips",success:function(e,t){e.find(".layui-table-tips-c").on("click",function(){C.close(t)})}})}),s.layMain.on("scroll",function(){var e=T(this),t=e.scrollLeft(),i=e.scrollTop();s.layHeader.scrollLeft(t),s.layTotal.scrollLeft(t),s.layFixed.find(p).scrollTop(i),C.close(s.tipsIndex)}),w.on("click",function(){w.trigger("table.remove.tool.panel")}),w.on("table.remove.tool.panel",function(){T(".layui-table-tool-panel").remove()}),k.on("resize",function(){s.fullSize(),s.scrollPatch(),s.setColsWidth()})},L.init=function(i,a){a=a||{};var e=T(i?'table[lay-filter="'+i+'"]':".layui-table[lay-data]"),c="Table element property lay-data configuration item has a syntax error: ";return e.each(function(){var e=T(this),t=e.attr("lay-data");try{t=new Function("return "+t)()}catch(e){h.error(c+t)}var n=[],o=T.extend({elem:this,cols:[],data:[],skin:e.attr("lay-skin"),size:e.attr("lay-size"),even:"string"==typeof e.attr("lay-even")},L.config,a,t);i&&e.hide(),e.find("thead>tr").each(function(l){o.cols[l]=[],T(this).children().each(function(e){var t=T(this),i=t.attr("lay-data");try{i=new Function("return "+i)()}catch(e){return h.error(c+i)}var a=T.extend({title:t.text(),colspan:t.attr("colspan")||0,rowspan:t.attr("rowspan")||0},i);a.colspan<2&&n.push(a),o.cols[l].push(a)})}),e.find("tbody>tr").each(function(e){var a=T(this),l={};a.children("td").each(function(e,t){var i=T(this),a=i.data("field");if(a)return l[a]=i.html()}),layui.each(n,function(e,t){var i=a.children("td").eq(e);l[t.field]=i.html()}),o.data[e]=l}),L.render(o)}),this},s.config={},L.eachCols=function(e,i,l){var t=s.config[e]||{},n=[],o=0;l=T.extend(!0,[],l||t.cols),layui.each(l,function(t,e){layui.each(e,function(e,i){if(i.colGroup){var a=0;o++,i.CHILD_COLS=[],layui.each(l[t+1],function(e,t){t.PARENT_COL_INDEX||1<a&&a==i.colspan||(t.PARENT_COL_INDEX=o,i.CHILD_COLS.push(t),a+=parseInt(1<t.colspan?t.colspan:1))})}i.PARENT_COL_INDEX||n.push(i)})});var a=function(e){layui.each(e||n,function(e,t){if(t.CHILD_COLS)return a(t.CHILD_COLS);"function"==typeof i&&i(e,t)})};a()},L.checkStatus=function(e){var i=0,a=0,l=[],t=L.cache[e]||[];return layui.each(t,function(e,t){t.constructor!==Array?t[L.config.checkName]&&(i++,l.push(L.clearCacheKey(t))):a++}),{data:l,isAll:!!t.length&&i===t.length-a}},L.exportFile=function(e,t,i){t=t||L.clearCacheKey(L.cache[e]),i=i||"csv";var n,o,a=s.config[e]||{},l={csv:"text/csv",xls:"application/vnd.ms-excel"}[i],c=document.createElement("a");if(y.ie)return h.error("IE_NOT_SUPPORT_EXPORTS");c.href="data:"+l+";charset=utf-8,\ufeff"+encodeURIComponent((n=[],o=[],layui.each(t,function(i,a){var l=[];"object"==typeof e?(layui.each(e,function(e,t){0==i&&n.push(t||"")}),layui.each(L.clearCacheKey(a),function(e,t){l.push(t)})):L.eachCols(e,function(e,t){t.field&&"normal"==t.type&&!t.hide&&(0==i&&n.push(t.title||""),l.push(a[t.field]))}),o.push(l.join(","))}),n.join(",")+"\r\n"+o.join("\r\n"))),c.download=(a.title||"table_"+(a.index||""))+"."+i,document.body.appendChild(c),c.click(),document.body.removeChild(c)},L.reload=function(e,t){var i=s.config[e];return t=t||{},i?(t.data&&t.data.constructor===Array&&delete i.data,L.render(T.extend(!0,{},i,t))):h.error("The ID option was not found in the table instance")},L.render=function(e){var t=new a(e);return s.call(t)},L.clearCacheKey=function(e){return delete(e=T.extend({},e))[L.config.checkName],delete e[L.config.indexName],e},L.init(),e(f,L)});